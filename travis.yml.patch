diff --git a/.travis.yml b/.travis.yml
index 7f5a7b2..d1c14d1 100644
--- a/.travis.yml
+++ b/.travis.yml
@@ -6,6 +6,14 @@
 #
 # version: 0.3.20190521
 #
+# This file is patched:
+# - We install the typediff utility from its repoistory.
+# - We amend the cabal.project with the BATTERIES environment variable.
+#   When BATTERIES=NO is set, we exclude the `base-compat-batteries` and
+#   `check` package/directories from the build.
+#   We assume that BATTERIES=NO implies that the tests are disabled as well.
+# - These changes are stored in travis.yml.patch.
+#
 language: c
 dist: xenial
 git:
@@ -102,7 +110,11 @@ before_install:
   - unset CC
   - CABAL=/opt/ghc/bin/cabal
   - CABALHOME=$HOME/.cabal
-  - export PATH="$CABALHOME/bin:$PATH"
+  # install typediff
+  - mkdir -p $HOME/.local/bin
+  - curl -L https://github.com/haskell-compat/base-compat/releases/download/typediff-0.1.4/typediff > $HOME/.local/bin/typediff
+  - chmod +x $HOME/.local/bin/typediff
+  - export PATH="/opt/ghc/bin:$CABALHOME/bin:$HOME/.local/bin:$PATH"
   - TOP=$(pwd)
   - HCNUMVER=$(( $(${HC} --numeric-version|sed -E 's/([0-9]+)\.([0-9]+)\.([0-9]+).*/\1 * 10000 + \2 * 100 + \3/') ))
   - echo $HCNUMVER
@@ -134,7 +146,7 @@ install:
   - |
     if $GHCHEAD; then
     echo "allow-newer: $($HCPKG list --simple-output | sed -E 's/([a-zA-Z-]+)-[0-9.]+/*:\1/g')" >> $CABALHOME/config
-    
+
     echo "repository head.hackage"                                                        >> $CABALHOME/config
     echo "   url: http://head.hackage.haskell.org/"                                       >> $CABALHOME/config
     echo "   secure: True"                                                                >> $CABALHOME/config
@@ -151,8 +163,7 @@ install:
   - touch cabal.project
   - |
     echo 'packages: "./base-compat"' >> cabal.project
-    echo 'packages: "./base-compat-batteries"' >> cabal.project
-    echo 'packages: "./check"' >> cabal.project
+    if [ ! "x$BATTERIES" = "xNO" ] ; then (echo 'packages: "./base-compat-batteries"' >> cabal.project; echo 'packages: "./check"' >> cabal.project) ; fi
   - |
     echo "write-ghc-environment-files: always" >> cabal.project
   - "for pkg in $($HCPKG list --simple-output); do echo $pkg | sed 's/-[^-]*$//' | (grep -vE -- '^(base-compat|base-compat-batteries|type-check)$' || true) | sed 's/^/constraints: /' | sed 's/$/ installed/' >> cabal.project.local; done"
@@ -164,8 +175,8 @@ install:
   - ${CABAL} v2-freeze -w ${HC} ${TEST} ${BENCH}
   - "cat cabal.project.freeze | sed -E 's/^(constraints: *| *)//' | sed 's/any.//'"
   - rm  cabal.project.freeze
-  - ${CABAL} v2-build -w ${HC} ${TEST} ${BENCH} --dep -j2 all
-  - ${CABAL} v2-build -w ${HC} --disable-tests --disable-benchmarks --dep -j2 all
+  - travis_wait ${CABAL} v2-build -w ${HC} ${TEST} ${BENCH} --dep -j2 all
+  - travis_wait ${CABAL} v2-build -w ${HC} --disable-tests --disable-benchmarks --dep -j2 all
 script:
   - DISTDIR=$(mktemp -d /tmp/dist-test.XXXX)
   # Packaging...
@@ -179,8 +190,7 @@ script:
   - touch cabal.project
   - |
     echo 'packages: "base-compat-*/*.cabal"' >> cabal.project
-    echo 'packages: "base-compat-batteries-*/*.cabal"' >> cabal.project
-    echo 'packages: "type-check-*/*.cabal"' >> cabal.project
+    if [ ! "x$BATTERIES" = "xNO" ] ; then (echo 'packages: "base-compat-batteries-*/*.cabal"' >> cabal.project; echo 'packages: "type-check-*/*.cabal"' >> cabal.project) ; fi
   - |
     echo "write-ghc-environment-files: always" >> cabal.project
   - "for pkg in $($HCPKG list --simple-output); do echo $pkg | sed 's/-[^-]*$//' | (grep -vE -- '^(base-compat|base-compat-batteries|type-check)$' || true) | sed 's/^/constraints: /' | sed 's/$/ installed/' >> cabal.project.local; done"
@@ -196,8 +206,8 @@ script:
   - if [ $HCNUMVER -ge 70002 ] && [ $HCNUMVER -lt 70201 ]  ||  [ $HCNUMVER -ge 70202 ] && [ $HCNUMVER -lt 70401 ]  ||  [ $HCNUMVER -ge 70402 ] && [ $HCNUMVER -lt 70801 ]  ||  [ $HCNUMVER -ge 70802 ] ; then ${CABAL} v2-test -w ${HC} ${TEST} ${BENCH} all ; fi
   # cabal check...
   - (cd base-compat-* && ${CABAL} -vnormal check)
-  - (cd base-compat-batteries-* && ${CABAL} -vnormal check)
-  - (cd type-check-* && ${CABAL} -vnormal check)
+  - if [ ! "x$BATTERIES" = "xNO" ] ; then (cd base-compat-batteries-* && ${CABAL} -vnormal check) ; fi
+  - if [ ! "x$BATTERIES" = "xNO" ] ; then (cd type-check-* && ${CABAL} -vnormal check) ; fi
   # haddock...
   - ${CABAL} v2-haddock -w ${HC} ${TEST} ${BENCH} all
   # Building without installed constraints for packages in global-db...
